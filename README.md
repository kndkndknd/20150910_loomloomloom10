# 概要
node.js + socket.io + web audio apiを用いて接続したクライアントで音をだすやつです

# 使い方(2017年5月14日時点)
## 基本の使用方法
- 各機能のコマンドをキーボード入力し、ENTERを押下します。
- キーボード入力内容は接続されたクライアントに表示されます（英数字のみ）
- stand aloneの場合以外は上記ですべての端末が機能発火します

## 発音の制御
 機能 | 概要 | 操作方法
----- | ---- | --------
VIDEO CHAT | 各クライアントで取得した音声、画像情報をサーバに送信、サーバはランダムな宛先に送信する | CHAT or VIDEOCHAT
FEEDBACK | 各クライアントの音声入力をそのまま出力します | FEEDBACK or FEED
SINEWAVE | 入力した周波数の正弦波を出力します | （数字を入力）
WHITENOISE | ホワイトノイズを出力します | WHITENOISE or NOISE
CLICK | 電子メトロノームを模した音を出力します | CLICK
RECORD | 映像、音声の情報を最大15秒分各クライアント側でデータ保持します | RECORD or REC
PLAYBACK | RECORDにて保持した映像、音声を再生します | PLAYBACK or PLAY
LOOKBACK | 各クライアントは15秒に一度映像、音声の情報をサーバに送信しており、本コマンドにてその映像、音声を各クライアントに送信、クライアント側は再生します | LOOKBACK or LOOK
LOOPBACK | LOOKBACKをループ再生する機能 | LOOPBACK or LOOP
BASS | ベース音（音程はいくつかの選択肢からランダム）を再生します。 | B（Enterなしで発音します）
SAMPLE RATE | VIDEO CHATまたはDRUMでの再生サンプリングレートを変更します（22050Hz→44100Hz→88200Hz→11025Hzの順に変更になります） | SAMPLERATE or RATE
FILTER | VIDEO CHATまたはFEEDBACKの再生にローパスフィルタをかけており、その周波数値を変更します（200Hz→2000Hz→8000Hz→14000Hz→0Hzの順に変更になります | FILTER
STOP | 音声・映像の再生を停止します | STOP or ESCキー（ESCはEnter不要）

- 発生した音を止めるのはSTOPまたは発生時と同じコマンドを実行すれば止まります
- 前回実施したコマンドを呼び出すには上矢印キーを押下します

## stand aloneについて
- カンマキーを押下するとstand alone状態になります。戻すにはもう一度カンマキー押下
- stand alone状態では全クライアントの制御はできず、キー入力した端末のみの操作となります
- 操作方法も変わります。詳細下記

機能 | 操作方法
----- | --------
CLICK | C
BASS | B
FEEDBACK | F
WHITENOISE | W or N
SAMPLE RATE | S

# 履歴
## 2017年5月14日の更新
- セブンスフロアでのソロのためのセット
- BASS, SAMPLE RATE, FILTER, DRUMの機能を追加
- 各機能を同時発音可能にした
- カンマ押下するとstand aloneに切り替わり、操作端末のみの音声発出を可能にします。状態管理が適当なので今後の課題
- 使用しない予定のDash Button関連の記載をコメントアウト。sudoが不要なの快適だった

## 2017年5月5日の改訂
### 概要
- お久しぶりです
- HOPKENでの矢代諭史とのデュオのためのセット
- だいぶインターフェースが変わってしまいましたが、音の出る仕組みは踏襲してます

### 主な変更
- 自分にとって死ぬほど使いづらかったコントロール用のページを廃し、クライアント画面でキーボード入力によって操作を行っています。
- Amazon Dash Buttonの信号を読み取って操作することも可能です。実行される機能の選択はランダムです。
- これまでの主機能だった複数端末間の音声、映像の送受信機能はVIDEO CHATという複数機能のうちのひとつとしてます
- それ以外にはFEEDBACK, SINEWAVE, WHITENOISE, CLICK, RECORD, PLAYBACK, LOOKBACK, LOOPBACKを追加してます。前からあった機能もあるかも。忘れた。
- あとたぶんES6にしてます

## 2016年4月29日の改訂
- 八広HIGHTIでの矢代諭史とのデュオのための改訂
- Socket.ioを介さない内蔵マイクとスピーカーによるフィードバックのモードを追加
- [Speak.js]("https://github.com/mattytemple/speak-js")を使用したテキスト読み上げモードの追加も行ったが演奏には使用しなかった

## 2016年2月28日の改訂
- UjeonggukでのChoi Joonyongとのデュオのための改訂
- Chromeのアップデートに伴いGetUserMediaがhttp通信でできなくなったためHTTPS化しました。
- ctrl.ejsからの操作でなくclient.ejsの操作でだいたいのことができるようにしています。

## 2015年11月29日の改訂
- space dikeでの矢代諭史とのデュオのための改訂
- 1〜4の出力について音声ファイル以外に画像ファイルもインポート可能にしました。public/filesに入っているものをctrlから指定してインポートします
- また、各端末で再生する内容を選択可能にしています

## 2015年10月24日の改訂
- 札幌LOGでのbikiとのデュオのための改訂
- iOS、Androidは受信専用端末として使用可能にしました。
- また、マイク入力とそれを蓄積したバッファ、WAVの出力頻度をスライダーで調整できるようにしています。

## 2015年9月28日の改訂
- forestlimitでのaenとのデュオのための改訂
- ビデオチャット機能を追加しました。
- また、一定のBPMで再生できるようになっています。

## 2015年9月10日のライブセット
- node.js + socket.io + web audio api + getUserMediaで各端末のマイクで拾った音をサーバ経由で送信し発音しています。
- ルートドメインが発音するクライアント、"/ctrl"がマイクでの集音や発音のオフ・オン、サーバからの送信の仕方など制御するクライアントです。
- たぶん原型はPOOLでのbiki、大城真とのトリオのために作成し、フライングティーポットでの梅原貴久、竹下勇馬とのトリオのために改訂したもの。
